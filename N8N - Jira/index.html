<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentação Técnica: Automação Jira + n8n</title>
    <style>
        :root {
            --jira-blue: #0052CC;
            --n8n-orange: #FF6D5A;
            --n8n-dark: #1A1A1A;
            --bg-light: #F4F5F7;
            --text-main: #172B4D;
        }
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; color: var(--text-main); max-width: 1000px; margin: 0 auto; padding: 20px; background-color: var(--bg-light); }
        
        /* Header Estilizado */
        header { background: linear-gradient(135deg, var(--jira-blue) 0%, var(--n8n-orange) 100%); color: white; padding: 3rem 2rem; border-radius: 12px; text-align: center; margin-bottom: 40px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h2 { color: var(--jira-blue); border-left: 6px solid var(--n8n-orange); padding-left: 15px; margin-top: 50px; text-transform: uppercase; font-size: 1.5rem; }
        h3 { color: var(--n8n-orange); margin-top: 30px; font-size: 1.2rem; display: flex; align-items: center; }
        h3::before { content: '⚡'; margin-right: 10px; }

        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.05); margin-bottom: 30px; border: 1px solid #DFE1E6; }
        
        img { max-width: 100%; height: auto; border-radius: 8px; margin: 20px 0; border: 2px solid #EBECF0; display: block; }
        
        /* Tags e Código */
        code { background-color: #FEEBE9; padding: 4px 8px; border-radius: 4px; color: #D63384; font-family: 'Consolas', monospace; font-size: 0.95em; border: 1px solid #FAD2CF; }
        .jql-box { background-color: #F4F5F7; padding: 15px; border-radius: 6px; border-left: 4px solid var(--jira-blue); font-family: 'Consolas', monospace; margin: 15px 0; overflow-x: auto; }
        
        .status-badge { background-color: #36B37E; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 0.85em; }
        
        footer { text-align: center; margin-top: 80px; padding: 40px; color: #6B778C; border-top: 1px solid #D1D5DB; }
    </style>
</head>
<body>

<header>
    <h1>Manual de Automação Inteligente</h1>
    <p>Integração Atlassian Jira Service Management & n8n Workflow</p>
</header>

<section class="card">
    <h2>1. Conectividade e Segurança</h2>
    <p>Para o n8n interagir com o Jira, é necessário estabelecer uma ponte segura via Token de API.</p>
    
    <h3>1.1 Geração do Token no Jira</h3>
    <p>Acesse o portal de segurança da Atlassian e crie um novo token.</p>
    <img src="criando_token_jira.png" alt="Tela de criação de token">
    
    <h3>1.2 Configuração de Credentials no n8n</h3>
    <p>No n8n, utilize o e-mail da conta e o token gerado para validar a conexão <code>Jira SW Cloud account 2</code>.</p>
    <img src="token_jira.png" alt="Token pronto">
</section>

<section class="card">
    <h2>2. Configuração do Workflow (Passo a Passo)</h2>
    <p>O fluxo foi desenhado para evitar a duplicidade de respostas através de uma trava lógica na descrição do chamado.</p>

    <h3>2.1 Trigger: Monitoramento Contínuo</h3>
    <p>O nó <strong>Schedule Trigger</strong> aciona o robô a cada <strong>5 minutos</strong>.</p>
    <img src="schedule_trigger.png" alt="Configuração de tempo">

    <h3>2.2 Filtro: Busca Avançada (JQL)</h3>
    <p>O nó <strong>Get many issues</strong> filtra apenas chamados relevantes e sem o "carimbo" de resposta.</p>
    <div class="jql-box">
        status = "Em Progresso" AND assignee = currentUser() AND (description !~ "comentado_por_dani" OR description is EMPTY)
    </div>
    <img src="get_many.png" alt="Interface JQL">

    <h3>2.3 Ação: Resposta Automática</h3>
    <p>O nó <strong>Add a comment</strong> envia a mensagem oficial ao cliente.</p>
    <ul>
        <li><strong>Issue Key:</strong> <code>{{ $json.key }}</code> (mapeamento dinâmico).</li>
        <li><strong>Mensagem:</strong> "Ola, como vai? Espero que esteja bem...".</li>
    </ul>
    <img src="add_comment.png" alt="Nó de comentário">

    <h3>2.4 Trava: Atualização do Chamado</h3>
    <p>O nó <strong>Update an issue</strong> insere o carimbo técnico na descrição.</p>
    <p>Expressão utilizada para não apagar o texto original:</p>
    <code>{{ $json.fields.description }} - comentado_por_dani</code>
    <img src="update_issue.png" alt="Nó de trava">
</section>

<section class="card">
    <h2>3. Ativação e Monitoramento</h2>
    <p>Após validar o fluxo com o botão <code>Execute Workflow</code>, é mandatório publicar a versão final.</p>
    
    <h3>3.1 Status de Publicação</h3>
    <p>Certifique-se de que o botão no canto superior direito exibe <span class="status-badge">Published</span>.</p>
    <img src="automacao_ok.png" alt="Fluxo publicado">

    <h3>3.2 Verificação no Jira</h3>
    <p>O chamado deve apresentar o comentário e a descrição atualizada.</p>
    <img src="resultado_jira.png" alt="Comentário no Jira">
</section>

<footer>
    <p>Desenvolvido por Dani • 2026 • Documentação Técnica de Autenticidade</p>
</footer>

</body>
</html>
